# Smart Rebuild Overview

## 워크플로우 전체 흐름

```
┌─────────────────────────────────────────────────────────────────┐
│  Phase 1: Capture (캡처)                                        │
├─────────────────────────────────────────────────────────────────┤
│  Playwright로 사이트 크롤링                                      │
│  ├── 모든 페이지 URL 수집 (재귀적)                               │
│  ├── 각 페이지 스크린샷 (fullPage)                               │
│  ├── HTML 저장                                                   │
│  └── sitemap.json 생성                                           │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│  Phase 2: Analyze (분석 & 매핑)                                  │
├─────────────────────────────────────────────────────────────────┤
│  레거시 소스 분석                                                │
│  ├── URL ↔ 소스 파일 매칭                                       │
│  ├── 정적/동적 자동 분류                                         │
│  ├── SQL 쿼리 추출 (동적인 경우)                                 │
│  ├── DB 스키마 분석                                              │
│  └── mapping.json 생성                                           │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│  Phase 3: Generate (코드 생성)                                   │
├─────────────────────────────────────────────────────────────────┤
│  정적 페이지:                                                    │
│  └── 스크린샷 + HTML → Next.js 정적 페이지                       │
│                                                                  │
│  동적 페이지:                                                    │
│  ├── SQL → Java Entity/Repository/Controller                    │
│  └── 스크린샷 + HTML → Next.js 페이지 (API 연동)                 │
└─────────────────────────────────────────────────────────────────┘
```

## 핵심 개념

### 1. Rebuild vs Migrate

| 항목 | 기존 마이그레이션 | Smart Rebuild |
|------|------------------|---------------|
| 접근법 | 코드 변환 | 새로 구축 |
| UI | 코드 분석 → 변환 | 스크린샷 → 새로 생성 |
| 로직 | 패턴 유지 | 클린 아키텍처 |
| 결과물 | 변환된 레거시 | 현대적 코드 |

### 2. 2-Track 전략

**Track 1 - 정적 콘텐츠:**
- Playwright로 라이브 사이트 스크래핑
- HTML에서 텍스트/이미지 추출
- Next.js 정적 페이지로 생성

**Track 2 - 동적 콘텐츠:**
- 소스 코드 분석
- SQL 쿼리 추출
- Backend API 생성
- Next.js 동적 페이지 생성

### 3. 자동 분류 기준

동적 페이지 판단:
- SQL 쿼리 존재
- DB 연결 함수 사용
- 세션 체크
- POST 데이터 처리
- 동적 파라미터 사용

정적 페이지 판단:
- 위 항목 모두 없음
- 순수 HTML + include/require만

## 출력 산출물

### sitemap.json (Phase 1)
```json
{
  "baseUrl": "https://example.com",
  "totalPages": 47,
  "pages": [{ "url", "screenshot", "html", "links" }]
}
```

### mapping.json (Phase 2)
```json
{
  "project": { "name", "sourceUrl", "sourcePath" },
  "summary": { "totalPages", "static", "dynamic" },
  "pages": [{ "capture", "source", "database", "output" }],
  "database": { "tables": [...] }
}
```

## 다음 단계

1. [Phase 1: Capture](./phase-1-capture.md)
2. [Phase 2: Analyze](./phase-2-analyze.md)
3. [Phase 3: Generate](./phase-3-generate.md)
